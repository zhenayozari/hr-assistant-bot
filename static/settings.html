<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–ø–∞–Ω–∏–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; } /* –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∫–∞—á–∫–∏ —Ä–∞–∑–º–µ—Ä–æ–≤ */
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: white;
            padding: 20px;
            padding-bottom: 90px; /* –û—Ç—Å—Ç—É–ø, —á—Ç–æ–±—ã –º–µ–Ω—é –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª–æ –∫–æ–Ω—Ç–µ–Ω—Ç */
        }
        .container { max-width: 600px; margin: 0 auto; }
        h1 { margin-bottom: 20px; font-size: 28px; }
        
        .card {
            background: #1e293b;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid #334155;
        }
        
        label { display: block; margin-bottom: 8px; color: #94a3b8; font-size: 14px; }
        
        input, textarea {
            width: 100%;
            padding: 12px;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            color: white;
            margin-bottom: 15px;
            font-size: 16px; /* –ß—Ç–æ–±—ã –Ω–∞ –∞–π—Ñ–æ–Ω–µ –Ω–µ –ø—Ä–∏–±–ª–∏–∂–∞–ª–æ */
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }

        button.save-btn {
            width: 100%;
            padding: 15px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        button.save-btn:hover { background: #2563eb; }
        
        .status { margin-top: 10px; font-size: 14px; text-align: center; min-height: 20px; }
        .success { color: #10b981; }
        .error { color: #ef4444; }

        /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1e293b;
            border-top: 1px solid #334155;
            display: flex;
            justify-content: space-around;
            padding: 10px 15px 20px 15px; /* –ß—É—Ç—å –±–æ–ª—å—à–µ –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–ª—è iPhone */
            z-index: 1000;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #64748b;
            text-decoration: none;
            font-size: 12px;
            width: 25%;
        }
        .nav-item.active { color: #3b82f6; }
        .nav-icon { font-size: 24px; margin-bottom: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>

        <div class="card">
            <h3>–û –∫–æ–º–ø–∞–Ω–∏–∏</h3>
            <br>
            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
            <input type="text" id="companyName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û–û–û –†–æ–º–∞—à–∫–∞">
            
            <label>–û–ø–∏—Å–∞–Ω–∏–µ (–¥–ª—è –ò–ò)</label>
            <textarea id="companyDesc" rows="4" placeholder="–ß–µ–º –≤—ã –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å? –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –ò–ò –ª—É—á—à–µ –ø–æ–¥–±–∏—Ä–∞—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤."></textarea>
        </div>

        <div class="card">
            <h3>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å HH.ru</h3>
            <p style="font-size: 12px; color: #64748b; margin-bottom: 10px;">
                Client ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ dev.hh.ru
            </p>
            <label>Client ID</label>
            <input type="text" id="hhClientId" placeholder="–í—Å—Ç–∞–≤—å Client ID">
            
            <label>Employer ID (ID —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è)</label>
            <input type="text" id="hhEmployerId" placeholder="–¶–∏—Ñ—Ä—ã –∏–∑ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–º–ø–∞–Ω–∏—é">
        </div>

        <button class="save-btn" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        <div id="status" class="status"></div>
    </div>

    <!-- –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é -->
    <div class="bottom-nav">
        <a href="/dashboard" class="nav-item">
            <div class="nav-icon">üìä</div>
            –î–∞—à–±–æ—Ä–¥
        </a>
        <a href="/vacancies" class="nav-item">
            <div class="nav-icon">üìã</div>
            –í–∞–∫–∞–Ω—Å–∏–∏
        </a>
        <a href="/upload" class="nav-item">
            <div class="nav-icon">üìÑ</div>
            –ê–Ω–∞–ª–∏–∑
        </a>
        <a href="/settings" class="nav-item active">
            <div class="nav-icon">‚öôÔ∏è</div>
            –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        </a>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –ü–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
        const userId = tg.initDataUnsafe?.user?.id || 'test_user_123';

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
        async function loadData() {
            try {
                const res = await fetch(`/api/profile/${userId}`);
                const data = await res.json();
                
                if (data) {
                    document.getElementById('companyName').value = data.company_name || '';
                    document.getElementById('companyDesc').value = data.company_description || '';
                    document.getElementById('hhClientId').value = data.hh_client_id || '';
                    document.getElementById('hhEmployerId').value = data.hh_employer_id || '';
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        async function saveSettings() {
            const btn = document.querySelector('button.save-btn');
            const status = document.getElementById('status');
            
            btn.disabled = true;
            btn.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
            status.textContent = '';

            const payload = {
                company_name: document.getElementById('companyName').value,
                company_description: document.getElementById('companyDesc').value,
                hh_client_id: document.getElementById('hhClientId').value,
                hh_employer_id: document.getElementById('hhEmployerId').value
            };

            try {
                const res = await fetch(`/api/profile/${userId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (res.ok) {
                    status.textContent = '‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!';
                    status.className = 'status success';
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                }
            } catch (e) {
                status.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è';
                status.className = 'status error';
            } finally {
                btn.disabled = false;
                btn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏';
            }
        }

        loadData();
    </script>
</body>
</html>